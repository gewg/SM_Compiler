# <u>Compiler</u>

## build

* .c -> .o
  * 预处理
  * (狭义) 编译
  * 汇编
  * 链接

* **预处理**

  * 展开宏

* **编译**

  * 生成汇编语言 

    (人类较易阅读的机器语言)

  * 生成.s

* **汇编**

  * 将汇编语言通过编译器转换成机器语言

    (机器语言以cpu执行效率为第一设计要素)

  * 生成.o (目标文件)

* **链接**

  * 加载程序库
  * 生成.o (可执行文件)



# <u>编译</u>

* 语法分析

* 语义分析

* 生成中间代码

* 代码生成

* Step

  * 解析代码, 获得**语法树**

  * 解析语法树, 除去冗余, 添加必要内容, 获得**抽象语法树(AST)**

  * 转换抽象语法树, 获得只在编译器内部使用的**中间代码**

    ---------------------------前端---------------------------------------

    ---------------------------后端---------------------------------------

  * 转换中间代码, 获得**汇编语言**

* 解析 (parse), 把代码转换成机器易于理解地形式

  * 语法分析 (syntax analyzing)
  * 使用parser进行解析

## 语法分析(前端)

* 解析代码, 获得语法树
* 对代码的表象分析

## 语义分析(前端)

* 解析语法树, 除去冗余, 添加必要内容, 获得抽象语法树(AST)

* 对代码表象之外的部分分析

  eg.  区分变量为局部变量还是全局变量，解析变量的声明和引用，变量和表达式的类型检查，检查在引用变量之前是否进行了初始化， 检查函数是否按照定义返回了结果

## 生成中间代码(前端)

* 转换抽象语法树, 获得只在编译器内部使用的中间代码

* 中间代码可以支持多种编程语言和机器语言

  * 让不同的前端和后端可以兼容

  * <img src="CompilerGraph\不使用中间语言.png" alt="不使用中间语言" style="zoom:50%;" />
  * <img src="CompilerGraph\使用中间语言.png" alt="使用中间语言" style="zoom: 50%;" />

## 代码生成(后端)

* 转换中间代码, 获得汇编语言
* 使用code generator

## 优化

* 优化可以在编译器的各个环节

## 语法树

* 语法树
  * 照搬代码的结构
  * <img src="CompilerGraph\语法树.png" alt="语法树" style="zoom:50%;" />
* 抽象语法树
  * 比语法树多了语义信息

